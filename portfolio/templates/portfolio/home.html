<!-- portfolio/templates/portfolio/home.html -->
{% extends "base.html" %} {% load static %} {% block title %}Home{% endblock %}
{% block content%}

<!-- Floating Quick Contact Panel -->
<div
  id="social-panel"
  class="fixed left-3 top-1/4 z-50 flex flex-col items-center space-y-2 bg-gray-200 dark:bg-zinc-800 p-2 rounded-lg shadow-md transition-all duration-500"
>
  <!-- Toggle Button -->
  <button
    id="toggle-panel"
    class="text-[10px] font-semibold px-2 py-1 rounded bg-zinc-700 dark:bg-zinc-600 text-white hover:bg-zinc-800 dark:hover:bg-zinc-700 transition duration-300"
  >
    Quick<br />Contact
  </button>

  <!-- Hidden Social Icons Panel -->
  <div
    id="icon-area"
    class="flex flex-col items-center space-y-4 opacity-0 max-h-0 overflow-hidden transition-all duration-700"
  >
    <!-- LinkedIn -->
    <a href="https://www.linkedin.com/in/umut-sarper-uzun" target="_blank" class="dark:invert dark:brightness-125">
      <img src="{% static 'icons/linkedin.svg' %}" alt="LinkedIn"
        class="w-6 h-6 object-contain hover:scale-110 transition-transform duration-300" />
    </a>

    <!-- GitHub -->
    <a href="https://www.github.com/umutsarperuzun" target="_blank" class="dark:invert dark:brightness-125">
      <img src="{% static 'icons/github.svg' %}" alt="GitHub"
        class="w-6 h-6 object-contain hover:scale-110 transition-transform duration-300" />
    </a>

    <!-- Instagram -->
    <a href="https://www.instagram.com/srpruzn" target="_blank" class="dark:invert dark:brightness-125">
      <img src="{% static 'icons/instagram.svg' %}" alt="Instagram"
        class="w-6 h-6 object-contain hover:scale-110 transition-transform duration-300" />
    </a>

    <!-- Email -->
    <a href="mailto:sarperuzun1@gmail.com?subject=Let's%20Connect&body=Hello%20Sarper%2C%0AI%20visited%20your%20portfolio%20and%20wanted%20to%20reach%20out."
      target="_blank" class="dark:invert dark:brightness-125">
      <img src="{% static 'icons/gmail.svg' %}" alt="Email"
        class="w-6 h-6 object-contain hover:scale-110 transition-transform duration-300" />
    </a>
  </div>
</div>

<section
  id="home"
  class="relative h-[40vh] sm:h-[50vh] overflow-hidden scroll-mt-28 flex items-center"
>

  <!-- 1. Arka plan geÃ§iÅŸli efekt -->
  <div
    class="absolute inset-0 z-0 bg-gradient-to-r from-white via-gray-200 to-black bg-[length:200%] animate-slideBg dark:from-gray-900 dark:via-gray-800 dark:to-black"
  ></div>

  <!-- 2. Kayan gÃ¶rseller -->
  <div class="absolute inset-0 z-10 overflow-hidden pointer-events-none">
    <div class="fade-mask absolute inset-0 z-10"></div>

    <div class="relative w-full h-full">
      <div
        class="slider-track flex animate-marquee h-full items-end min-w-[600%]"
      >
        {% for img in slider_images %}
        <img
          src="{% static img %}"
          alt="Slider Image"
          class="h-[80%] w-auto min-w-[700px] sm:min-w-[800px] object-contain opacity-20 grayscale contrast-75 dark:opacity-30 dark:grayscale-0 dark:contrast-100"
        />
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- 3. Decode yazÄ±sÄ± (Ã¼st katman) -->
  <div class="relative z-30 w-full text-left px-6 md:px-16">
    <h1
      class="text-4xl sm:text-5xl md:text-6xl font-bold text-gray-900 dark:text-gray-100"
    >
      <span id="decoding-title"></span>
    </h1>
  </div>
</section>


<section
  id="about"
  class="min-h-screen bg-gray-100 dark:bg-gray-900 py-20 scroll-mt-28"
>
  <h2 id="about-title" class="text-3xl font-bold text-center text-gray-900 dark:text-white opacity-0 transform scale-50 transition-all duration-1500">
    About Me
  </h2>

  <div class="mt-12 grid grid-cols-1 md:grid-cols-2 gap-10 w-full px-16">
    <!-- Sol: YazÄ± -->
    <div id="about-text" class="text-center max-w-xl mx-auto opacity-0 transform translate-x-[-100px] transition-all duration-1500">
      <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">
        Who am I?
      </h3>
      <p class="text-gray-700 dark:text-gray-300 leading-relaxed">
        Hi, Iâ€™m Umut Sarper Uzun â€” a junior software developer who enjoys turning
        real problems into simple, working products. I craft clean UIs with JavaScript/React
        and Tailwind, and build dependable backends with Python (Django/Flask) or Node.js/Express,
        using REST APIs and MySQL. I care about clarity, performance, and shipping in small, frequent
        iterations; Git/GitHub keeps me tidy, while Docker and n8n help me automate and scale. With 
        an MSc in Computer Science (Distinction), Iâ€™m always learning and I like teams where 
        straightforward communication and delivering value matter more than buzzwords.
      </p>
    </div>

    <!-- SaÄŸ: Yetenekler -->
    <div
      id="skills-section"
      class="grid grid-cols-1 md:grid-cols-3 gap-8 opacity-0 transform translate-x-[100px] transition-all duration-1500"
    >
      <!-- Backend -->
      <div class="space-y-4">
        <h4 class="text-xl font-semibold text-gray-700 dark:text-white">
          Backend
        </h4>
        <!-- Python -->
        {% include "portfolio/components/skill_item.html" with icon="icons/python.svg" name="Python" percentage="88" color="blue" %}
        <!-- Flask -->
         {% include "portfolio/components/skill_item.html" with icon="icons/flask.svg" name="Flask" percentage="82" color="emerald" %}
        <!-- MySQL -->
        {% include "portfolio/components/skill_item.html" with icon="icons/mysql.svg" name="MySQL" percentage="80" color="emerald" %}
        <!-- Node.js -->
        {% include "portfolio/components/skill_item.html" with icon="icons/node.svg" name="Node.js (Express.js)" percentage="78" color="emerald" %}
        <!-- Django -->
        {% include "portfolio/components/skill_item.html" with icon="icons/django.svg" name="Django" percentage="72" color="emerald" %}
      </div>
      <!-- Frontend -->
      <div class="space-y-4">
        <h4 class="text-xl font-semibold text-gray-700 dark:text-white">Frontend</h4>
        <!-- JavaScript -->
        {% include "portfolio/components/skill_item.html" with icon="icons/javascript.svg" name="JavaScript" percentage="85" color="yellow" %}
        <!-- React -->
        {% include "portfolio/components/skill_item.html" with icon="icons/react.svg" name="React" percentage="75" color="sky" %}
        <!-- Tailwind CSS -->
        {% include "portfolio/components/skill_item.html" with icon="icons/css.svg" name="CSS / Tailwind CSS" percentage="78" color="cyan" %}
        <!-- HTML -->
        {% include "portfolio/components/skill_item.html" with icon="icons/html.svg" name="HTML5" percentage="80" color="cyan" %}
      </div>
      <!-- Tools & Others -->
      <div class="space-y-4">
        <h4 class="text-xl font-semibold text-gray-700 dark:text-white">Tools & Others</h4>
        <!-- Git & GitHub -->
        {% include "portfolio/components/skill_item.html" with icon="icons/git.svg" name="Git & GitHub" percentage="85" color="orange" %}
        <!-- Docker -->
        {% include "portfolio/components/skill_item.html" with icon="icons/docker.svg" name="Docker" percentage="58" color="blue" %}
        <!-- Postman -->
        {% include "portfolio/components/skill_item.html" with icon="icons/postman.svg" name="Postman" percentage="80" color="orange" %}
        <!-- n8n -->
        {% include "portfolio/components/skill_item.html" with icon="icons/n8n.svg" name="n8n" percentage="74" color="orange" %}
      </div>
    </div>
  </div>
</section>

<section
  id="projects"
  class="relative bg-gray-100 dark:bg-gray-900 scroll-mt-28 pt-24 pb-15"
>

  <!-- Arka plan yÄ±ldÄ±zlar -->
  <canvas id="star-canvas" class="absolute inset-0 w-full h-full z-0 pointer-events-none"></canvas>

  <!-- Explore Projects AlanÄ± -->
<div
  id="project-trigger"
  class="flex justify-center items-center transition-all duration-700 relative z-10"
>



    <div
      id="main-project-card"
      class="bg-white dark:bg-zinc-800 shadow-lg rounded-2xl px-12 py-20 text-center text-3xl font-bold text-gray-900 dark:text-white transition-transform duration-500 cursor-pointer hover:scale-105 hover:shadow-2xl hover:bg-gradient-to-r hover:from-indigo-500 hover:to-purple-500 dark:hover:brightness-110"
    >
      ðŸš€ Explore Projects
    </div>
  </div>

  <!-- BaÅŸlÄ±k -->
  <h2 id="project-heading" class="text-3xl font-bold text-center text-gray-900 dark:text-white opacity-0 transition-opacity duration-700 mb-2 md:mb-8">
    Projects
  </h2>

  <!-- Kartlar -->
  <div class="max-w-6xl mx-auto">
    <div
  id="project-fanout"
  class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6 px-4"
>

<div class="project-card"
     data-title="Project Name 1"
     data-description="A short description of the projectâ€™s purpose, key features, and what problem it solves."
     data-cover="{% static 'images/testss.png' %}"
     data-tags="Django,Tailwind,PostgreSQL"
     data-live="#"
     data-repo="#">
  <div class="project-card-inner">
    <h3 class="text-xl font-semibold">Newsletterly 
      <br>(Team Project)</h3>
    <p class="text-sm mt-2">AI-driven newsletters auto curation, AI summaries, rich media templates, and optimized subject lines</p>
  </div>
  <button class="card-close">âœ–</button>
</div>




<div class="project-card"
     data-title="Project Name 2"
     data-description="Brief overview of features and stack."
     data-cover="{% static 'images/testss.png' %}"
     data-tags="React,FastAPI"
     data-live="#"
     data-repo="#">
  <div class="project-card-inner">
    <h3 class="text-xl font-semibold">AI Chatbot <br>(Fleet Management)</h3>
    <p class="text-sm mt-2">Automates fleet documents & reports via Flask backend with OneDrive + CheckedSafe API integrations and NLP.</p>
  </div>
  <button class="card-close">âœ–</button>
</div>



<div class="project-card"
     data-title="Project Name 3"
     data-description="Short teaser about the project."
     data-cover="{% static 'images/testss.png' %}"
     data-tags="Node,MongoDB"
     data-live="#"
     data-repo="#">
  <div class="project-card-inner">
    <h3 class="text-xl font-semibold">POS App</h3>
    <p class="text-sm mt-2">Real-time sales, inventory, and reporting with role-based access (React + Node + MongoDB + Redux).</p>
  </div>
  <button class="card-close">âœ–</button>
</div>



<div class="project-card"
     data-title="Project Name 4"
     data-description="Short teaser about the project."
     data-cover="{% static 'images/testss.png' %}"
     data-tags="Flask,MySQL"
     data-live="#"
     data-repo="#">
  <div class="project-card-inner">
    <h3 class="text-xl font-semibold">n8n Blog Generator</h3>
    <p class="text-sm mt-2">Weekly topics â†’ AI drafts â†’ approval â†’ auto-publish, orchestrated in n8n with Drive integrations.</p>
  </div>
  <button class="card-close">âœ–</button>
</div>



<div class="project-card"
     data-title="Project Name 5"
     data-description="Short teaser about the project."
     data-cover="{% static 'images/testss.png' %}"
     data-tags="Python,Docker"
     data-live="#"
     data-repo="#">
  <div class="project-card-inner">
    <h3 class="text-xl font-semibold">E-Commerce Platform for Sneaker Sales</h3>
    <p class="text-sm mt-2">Auth, product filters, secure checkout, and order management â€” built with React, Node (Express), and MongoDB.</p>
  </div>
  <button class="card-close">âœ–</button>
</div>


    </div>
  </div>
  <!-- Blur Arkaplan -->
<div id="overlay-blur" class="fixed inset-0 bg-black/30 backdrop-blur-sm z-40 hidden"></div>

<!-- Single reusable Project Modal -->
<div id="project-modal" class="fixed inset-0 z-50 hidden items-center justify-center px-4">
  <div id="project-modal-overlay" class="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
  <div class="relative bg-white dark:bg-zinc-900 rounded-2xl shadow-2xl max-w-3xl w-full overflow-hidden">
    <button id="project-modal-close" class="absolute top-3 right-3 text-white bg-zinc-800/70 hover:bg-zinc-700 rounded-full w-8 h-8 flex items-center justify-center">âœ–</button>
    <div class="p-6 space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <img id="pm-cover" src="" alt="Cover" class="w-full h-56 md:h-64 object-cover rounded-xl" />
        </div>
        <div class="space-y-3">
          <h3 id="pm-title" class="text-xl font-semibold text-gray-900 dark:text-white"></h3>
          <p id="pm-desc" class="text-sm text-gray-700 dark:text-gray-300"></p>
          <div>
            <h4 class="text-sm font-semibold text-gray-800 dark:text-gray-200">Stack</h4>
            <div id="pm-tags" class="flex flex-wrap gap-2 mt-2"></div>
          </div>
        </div>
      </div>
      <div>
        <h4 class="text-sm font-semibold text-gray-800 dark:text-gray-200">Overview</h4>
        <ul id="pm-features" class="mt-2 list-disc list-inside text-sm text-gray-700 dark:text-gray-300 space-y-1"></ul>
      </div>
      <div>
        <h4 class="text-sm font-semibold text-gray-800 dark:text-gray-200">Links</h4>
        <div id="pm-actions" class="flex flex-wrap gap-2 mt-2"></div>
      </div>
    </div>
  </div>
</div>


</section>


<section
  id="blog"
  class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white pt-16 pb-8 scroll-mt-28"
>
  <h2 class="text-3xl font-bold text-center mb-6">Blog</h2>

  <div class="mx-auto bg-black text-[#00FF00] font-mono w-[90%] max-w-2xl rounded-lg shadow-2xl border border-gray-700">
    
    <!-- Fake Top Bar -->
    <div class="bg-[#1e1e1e] h-8 rounded-t-lg px-4 flex items-center justify-between">
      <span class="text-gray-400 text-xs">Command Prompt</span>
      <div class="flex space-x-2">
        <span class="w-3 h-3 bg-red-500 rounded-full"></span>
        <span class="w-3 h-3 bg-yellow-500 rounded-full"></span>
        <span class="w-3 h-3 bg-green-500 rounded-full"></span>
      </div>
    </div>

    <!-- Terminal Content -->
    <div class="p-4 text-sm leading-relaxed h-64 sm:h-72 overflow-y-auto" id="terminal-typing-container">
      <div id="terminal-typing"></div>
      <span class="blink">â–ˆ</span>
    </div>
    
  </div>
</section>

<section
  id="contact"
  class="h-auto bg-gray-100 dark:bg-gray-900 py-20 transition-colors duration-500 scroll-mt-28"
>
  <div
    data-aos="fade-up"
    data-aos-duration="1200"
    data-aos-easing="ease-out-cubic"
    class="bg-transparent"
  >
    <h2 class="text-3xl font-bold text-center mb-10 dark:text-white relative z-10">Get in Touch</h2>

    <!-- Django messages -->
    {% if messages %}
      <div class="max-w-4xl mx-auto px-4 mb-6 relative z-50">
        {% for message in messages %}
          <div class="rounded-lg px-4 py-3 text-sm shadow-lg ring-1 ring-white/10 {{ message.tags|default:'' }} {% if message.tags == 'success' %}bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-white{% elif message.tags == 'error' %}bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-white{% else %}bg-gray-100 text-gray-800 dark:bg-zinc-800/60 dark:text-white{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <div class="max-w-4xl mx-auto px-4 relative z-10">
      <!-- Gradient ring + glass card -->
      <div class="gradient-ring rounded-2xl p-0.5">
        <div class="glass-card rounded-2xl">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-8">

            <!-- Left: Copy / Socials -->
            <div class="flex flex-col justify-center space-y-5">
              <h3 class="text-2xl md:text-3xl font-semibold text-gray-900 dark:text-white leading-tight">
                Letâ€™s build something meaningful together
              </h3>
              <p class="text-gray-700 dark:text-gray-300">
                Got a project or an idea? Iâ€™d love to hear about it. Drop a line and Iâ€™ll get back soon.
              </p>

              <div class="flex items-center gap-4">
                <a href="https://www.linkedin.com/in/umut-sarper-uzun" target="_blank" class="dark:invert dark:brightness-125">
                  <img src="{% static 'icons/linkedin.svg' %}" alt="LinkedIn" class="w-6 h-6" />
                </a>
                <a href="https://www.github.com/umutsarperuzun" target="_blank" class="dark:invert dark:brightness-125">
                  <img src="{% static 'icons/github.svg' %}" alt="GitHub" class="w-6 h-6" />
                </a>
                <a href="mailto:sarperuzun1@gmail.com" class="dark:invert dark:brightness-125">
                  <img src="{% static 'icons/gmail.svg' %}" alt="Email" class="w-6 h-6" />
                </a>
              </div>
            </div>

            <!-- Right: Contact form (backend wired) -->
            <div>
              <form class="space-y-4" method="post" action="{% url 'contact_submit' %}">
                {% csrf_token %}
                <div>
                  <label class="block text-sm mb-1 text-gray-700 dark:text-gray-300">Name</label>
                  <input name="name" type="text" placeholder="Your name" class="w-full rounded-lg bg-white/70 dark:bg-zinc-800/70 border border-gray-300 dark:border-zinc-700 px-4 py-3 contact-input focus:outline-none" required />
                </div>
                <div>
                  <label class="block text-sm mb-1 text-gray-700 dark:text-gray-300">Email</label>
                  <input name="email" type="email" placeholder="name@example.com" class="w-full rounded-lg bg-white/70 dark:bg-zinc-800/70 border border-gray-300 dark:border-zinc-700 px-4 py-3 contact-input focus:outline-none" required />
                </div>
                <div>
                  <label class="block text-sm mb-1 text-gray-700 dark:text-gray-300">Message</label>
                  <textarea name="message" rows="5" placeholder="Tell me a bit about your projectâ€¦" class="w-full rounded-lg bg-white/70 dark:bg-zinc-800/70 border border-gray-300 dark:border-zinc-700 px-4 py-3 contact-input focus:outline-none" required></textarea>
                </div>
                <button type="submit" class="shine-btn relative inline-flex items-center justify-center w-full md:w-auto px-6 py-3 rounded-lg font-medium text-white bg-gradient-to-r from-sky-400 via-indigo-500 to-fuchsia-500 hover:from-sky-500 hover:via-indigo-600 hover:to-fuchsia-600 transition">
                  Send Message
                </button>
              </form>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<script>

  // 1. Navbar offset'li scroll davranÄ±ÅŸÄ±
function setupSmoothScrollWithOffset() {
  const navbar = document.querySelector("nav");
  const navbarHeight = navbar ? navbar.offsetHeight : 0;
  const links = document.querySelectorAll("a.scroll-link");

  links.forEach(link => {
    link.addEventListener("click", (e) => {
      e.preventDefault();
      const targetId = link.getAttribute("href").substring(1);
      const targetEl = document.getElementById(targetId);

      if (targetEl) {
        const offsetTop = targetEl.offsetTop;
        window.scrollTo({
          top: offsetTop - navbarHeight + 6,
          behavior: "smooth"
        });
      }
    });
  });
}

  // 2. Quick Contact Panel (sol taraftaki aÃ§Ä±lÄ±r panel)
function setupQuickContactPanel() {
  const contactToggleBtn = document.getElementById("toggle-panel");
  const iconSection = document.getElementById("icon-area");
  if (!contactToggleBtn || !iconSection) return;
  let panelOpen = false;

  contactToggleBtn.addEventListener("click", () => {
    iconSection.classList.toggle("opacity-0");
    iconSection.classList.toggle("max-h-0");
    iconSection.classList.toggle("max-h-[500px]");
    panelOpen = !panelOpen;
  });

  window.addEventListener("scroll", () => {
    if (panelOpen) {
      iconSection.classList.add("opacity-0", "max-h-0");
      iconSection.classList.remove("max-h-[500px]");
      panelOpen = false;
    }
  });
}

// 3. Decode yazÄ± animasyonu (hero baÅŸlÄ±ÄŸÄ±)
function decodeEffect() {
  const display = document.getElementById("decoding-title");
  if (!display) return;
  const targetText = "This is my portfolio";
  const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890!@#$%^&*()-_=+";
  let iterations = 0;

  function animate() {
    const length = targetText.length;
    let output = "";

    for (let i = 0; i < length; i++) {
      output += i < iterations ? targetText[i] : characters[Math.floor(Math.random() * characters.length)];
    }

    display.textContent = output;

    if (iterations <= length) {
      iterations++;
      setTimeout(animate, 60);
    } else {
      setTimeout(() => {
        iterations = 0;
        animate();
      }, 2000);
    }
  }

  animate();
}

// 4. Projects & Blog scroll reveal animasyonlarÄ±
function setupScrollRevealAnimations() {
  const sections = document.querySelectorAll(".reveal-manual");
  let lastScrollY = window.scrollY;

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      const currentScrollY = window.scrollY;
      const scrollingDown = currentScrollY > lastScrollY;

      if (entry.isIntersecting && scrollingDown) {
        const sectionName = entry.target.dataset.section;
        if (sectionName === "projects") entry.target.classList.add("animate-slide-in");
        else if (sectionName === "blog") entry.target.classList.add("animate-slide-left");
      }

      if (!entry.isIntersecting) {
        entry.target.classList.remove("animate-slide-in", "animate-slide-left");
      }

      lastScrollY = currentScrollY;
    });
  }, { threshold: 0.05 });

  sections.forEach(section => observer.observe(section));
}

// 5. Skill bar animasyonlarÄ±
function setupSkillAnimation() {
  const skillSection = document.getElementById("skills-section");
  const skillBars = document.querySelectorAll(".skill-bar");
  if (!skillSection || !skillBars.length) return;
  let animationStarted = false;

  function animateSkills() {
    skillBars.forEach(bar => {
      bar.style.transition = "none";
      bar.style.width = "0%";
    });

    setTimeout(() => {
      skillBars.forEach((bar, index) => {
        setTimeout(() => {
          const targetWidth = bar.getAttribute("data-width");
          bar.style.transition = "width 1.5s ease";
          bar.style.width = targetWidth;
        }, index * 150);
      });
    }, 50);
  }

  const observering = new IntersectionObserver((entries, observering) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting && !animationStarted) {
        animationStarted = true;
        animateSkills();
        setInterval(() => animateSkills(), 10000);
        observering.unobserve(entry.target);
      }
    });
  }, { threshold: 0.3 });

  observering.observe(skillSection);
}

// 6. Skill ikonlarÄ±na scroll ile spin animasyonu
function setupSkillIconAnimations() {
  const icons = document.querySelectorAll(".skill-icon");
  if (!icons.length) return;

  const iconObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const icon = entry.target;
        icon.classList.remove("animate-spin-once");
        void icon.offsetWidth;
        icon.classList.add("animate-spin-once");
      }
    });
  }, { threshold: 0.6 });

  icons.forEach(icon => iconObserver.observe(icon));
}

// 7. Proje kartÄ± fanout + scroll + tilt
function setupProjectCardFanout() {
  const trigger = document.getElementById("project-trigger");
  const mainCard = document.getElementById("main-project-card");
  const fanout = document.getElementById("project-fanout");
  const heading = document.getElementById("project-heading");
  const cards = document.querySelectorAll(".project-card");
  let opened = false;

  if (!mainCard || !trigger || !fanout || !heading) return;

  mainCard.addEventListener("click", () => {
    if (opened) return;

    const projectsEl = document.getElementById("projects");
    const navbar = document.querySelector("nav");
    const navbarHeight = navbar ? navbar.offsetHeight : 0;

    if (projectsEl) {
      const offsetTop = projectsEl.offsetTop;
      window.scrollTo({
        top: offsetTop - navbarHeight + 4,
        behavior: "smooth"
      });
    }

    trigger.classList.add('opacity-0', 'pointer-events-none', 'hidden');
    trigger.classList.remove('h-[300px]');
    heading.classList.remove('opacity-0');
    fanout.classList.add('active');

    cards.forEach((card, index) => {
      setTimeout(() => {
        card.classList.remove('hidden');
        card.style.opacity = "1";
        card.style.transform = "scale(1)";
      }, 150 * index);
    });

    activateTiltEffect();
    opened = true;
  });

  const obsrvr = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting && opened) {
        trigger.classList.remove('opacity-0', 'pointer-events-none', 'hidden');
        trigger.classList.add('h-[300px]');
        heading.classList.add('opacity-0');
        fanout.classList.add('opacity-0');
        fanout.classList.remove('active');
        cards.forEach(card => {
          card.classList.add('hidden');
          card.style.opacity = "0";
          card.style.transform = "scale(0.9)";
        });
        opened = false;
      }
    });
  }, { threshold: 0.3 });

  const projectsEl = document.getElementById('projects');
  if (projectsEl) obsrvr.observe(projectsEl);
}

// 8. Kart bÃ¼yÃ¼tme & blur overlay sistemi
function setupProjectCardOverlay() { /* deprecated: kept empty to avoid duplicate handlers */ }

// New: Centralized modal for project details
function setupProjectModal() {
  const cards = document.querySelectorAll('.project-card');
  const modal = document.getElementById('project-modal');
  const modalOverlay = document.getElementById('project-modal-overlay');
  const modalClose = document.getElementById('project-modal-close');
  const pmCover = document.getElementById('pm-cover');
  const pmTitle = document.getElementById('pm-title');
  const pmDesc = document.getElementById('pm-desc');
  const pmTags = document.getElementById('pm-tags');
  const pmActions = document.getElementById('pm-actions');
  const pmFeatures = document.getElementById('pm-features');

  if (!cards.length || !modal) return;

  function openModal() {
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    document.body.style.overflow = 'hidden';
  }
  function closeModal() {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = '';
    pmCover.src = '';
    pmTitle.textContent = '';
    pmDesc.textContent = '';
    pmTags.innerHTML = '';
    pmActions.innerHTML = '';
    pmFeatures.innerHTML = '';
  }

  cards.forEach(card => {
    card.addEventListener('click', () => {
      const title = card.getAttribute('data-title') || '';
      const desc = card.getAttribute('data-description') || '';
      const cover = card.getAttribute('data-cover') || '';
      const tags = (card.getAttribute('data-tags') || '').split(',').map(t => t.trim()).filter(Boolean);
      const live = card.getAttribute('data-live');
      const repo = card.getAttribute('data-repo');
      const features = (card.getAttribute('data-features') || '').split('|').map(f => f.trim()).filter(Boolean);

      pmTitle.textContent = title;
      pmDesc.textContent = desc;
      if (cover) pmCover.src = cover;

      pmTags.innerHTML = '';
      tags.forEach(t => {
        const span = document.createElement('span');
        span.className = 'chip';
        span.textContent = t;
        pmTags.appendChild(span);
      });

      pmFeatures.innerHTML = '';
      features.forEach(f => {
        const li = document.createElement('li');
        li.textContent = f;
        pmFeatures.appendChild(li);
      });

      pmActions.innerHTML = '';
      if (live && live !== '#') {
        const a = document.createElement('a');
        a.href = live; a.target = '_blank';
        a.className = 'project-btn'; a.textContent = 'Live';
        pmActions.appendChild(a);
      }
      if (repo && repo !== '#') {
        const a = document.createElement('a');
        a.href = repo; a.target = '_blank';
        a.className = 'project-btn'; a.textContent = 'Repo';
        pmActions.appendChild(a);
      }

      openModal();
    });
  });

  function shouldCloseOnWheel(e) {
    // Close modal if wheel happens outside modal content area (i.e., on overlay)
    const content = modal.querySelector('.relative.bg-white, .relative.bg-zinc-900');
    if (!content) return true;
    return !content.contains(e.target);
  }

  modal.addEventListener('click', (e) => {
    if (e.target === modal || e.target === modalOverlay) closeModal();
  });
  if (modalOverlay) modalOverlay.addEventListener('click', closeModal);
  if (modalClose) modalClose.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });
  // Close when scrolling the page (wheel) outside modal content
  modal.addEventListener('wheel', (e) => { if (shouldCloseOnWheel(e)) closeModal(); }, { passive: true });
}

// 9. Tilt efekt
function activateTiltEffect() {
  const projectCards = document.querySelectorAll('.project-card');
  if (!projectCards.length) return;

  projectCards.forEach(card => {
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const rotateX = ((y - centerY) / centerY) * -20;
      const rotateY = ((x - centerX) / centerX) * 20;
      card.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
    });

    card.addEventListener('mouseleave', () => {
      card.style.transform = 'rotateX(0deg) rotateY(0deg)';
    });
  });
}

// 10. Terminal yazÄ±sÄ±
function setupTerminalTyping() {
  const container = document.getElementById("terminal-typing-container");
  const terminal = document.getElementById("terminal-typing");
  if (!container || !terminal) return;

  const lines = [
    "Microsoft Windows [Version 10.0.26100.4061]",
    "(c) Microsoft Corporation. All rights reserved.",
    "",
    "C:\\Users\\sarpe> Initializing blog system...",
    "C:\\Users\\sarpe> Connecting to GPT-4...",
    "C:\\Users\\sarpe> Generating knowledge modules...",
    "C:\\Users\\sarpe> Status: ONLINE âœ…"
  ];

  let timeouts = [];

  function clearTimers() {
    timeouts.forEach(id => clearTimeout(id));
    timeouts = [];
  }

  function startTyping() {
    terminal.textContent = "";
    const firstLine = document.createElement("div");
    terminal.appendChild(firstLine);

    let lineIndex = 0;
    let charIndex = 0;
    let currentLine = "";

    function typeNextChar() {
      if (lineIndex >= lines.length) return;

      const line = lines[lineIndex];
      if (charIndex < line.length) {
        currentLine += line.charAt(charIndex++);
        terminal.lastChild.textContent = currentLine;
        // Auto-scroll container to bottom without affecting layout height
        container.scrollTop = container.scrollHeight;
        timeouts.push(setTimeout(typeNextChar, 30));
      } else {
        const br = document.createElement("div");
        br.textContent = "";
        terminal.appendChild(br);
        lineIndex++;
        charIndex = 0;
        currentLine = "";
        container.scrollTop = container.scrollHeight;
        timeouts.push(setTimeout(typeNextChar, 400));
      }
    }

    typeNextChar();
  }

  // Start immediately on load
  startTyping();

  // Restart when blog section comes into view
  const blogSection = document.getElementById("blog");
  if (blogSection && "IntersectionObserver" in window) {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          clearTimers();
          startTyping();
        }
      });
    }, { threshold: 0.5 });
    observer.observe(blogSection);
  }
}

// About Me section animasyonu
function setupAboutMeAnimations() {
  const aboutSection = document.getElementById('about');
  const aboutTitle = document.getElementById('about-title');
  const aboutText = document.getElementById('about-text');
  const skillsSection = document.getElementById('skills-section');

  if (!aboutSection || !aboutTitle || !aboutText || !skillsSection) return;

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        // About Me baÅŸlÄ±ÄŸÄ± - zoom in
        setTimeout(() => {
          aboutTitle.classList.remove('opacity-0', 'scale-50');
          aboutTitle.classList.add('opacity-100', 'scale-100');
        }, 100);

        // Sol metin - soldan gel
        setTimeout(() => {
          aboutText.classList.remove('opacity-0', 'translate-x-[-100px]');
          aboutText.classList.add('opacity-100', 'translate-x-0');
        }, 300);

        // SaÄŸ yetenekler - saÄŸdan gel
        setTimeout(() => {
          skillsSection.classList.remove('opacity-0', 'translate-x-[100px]');
          skillsSection.classList.add('opacity-100', 'translate-x-0');
        }, 500);
      } else {
        // Scroll dÄ±ÅŸÄ±na Ã§Ä±ktÄ±ÄŸÄ±nda animasyonlarÄ± sÄ±fÄ±rla
        aboutTitle.classList.add('opacity-0', 'scale-50');
        aboutTitle.classList.remove('opacity-100', 'scale-100');
        
        aboutText.classList.add('opacity-0', 'translate-x-[-100px]');
        aboutText.classList.remove('opacity-100', 'translate-x-0');
        
        skillsSection.classList.add('opacity-0', 'translate-x-[100px]');
        skillsSection.classList.remove('opacity-100', 'translate-x-0');
      }
    });
  }, { threshold: 0.3 });

  observer.observe(aboutSection);
}

document.addEventListener("DOMContentLoaded", () => {
  setupQuickContactPanel();
  decodeEffect();
  setupScrollRevealAnimations();
  setupSkillAnimation();
  setupSkillIconAnimations();
  setupProjectCardFanout();
  // setupProjectCardOverlay(); // deprecated
  setupProjectModal();
  // initStarField for footer is already called in base.html
  if (typeof initStarField === 'function') {
    const starCanvas = document.getElementById('star-canvas');
    if (starCanvas) initStarField("star-canvas");
  }
  setupTerminalTyping();
  setupSmoothScrollWithOffset();
  setupAboutMeAnimations();
});

</script>
{% endblock %}